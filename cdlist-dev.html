<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KGNU Wish List</title>
    <!-- Bootstrap CSS -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <style>
        .received {
            text-decoration: line-through;
        }
    </style>

    <!--
        todo:
        wire up to vuejs + axios instead of jquery
        change to table formatting
        add sort options by name column.
        style to match kgnu.org a little more
    -->

</head>

<body>
    <div class="container">
        <br>
        <h3>KGNU CD Thank You Gifts</h3>
        <div class="row">
            <div class="col">
                <p>We have too many CDs available as thank you gifts to mention on air!</p>
                <p>Mention the specific <strong>Album Title</strong> and <strong>Artist</strong> in the thank you gift area in the donation form if you'd like one of these as your gift.</p>

            </div>
        </div>

<!--         <div class="row" id="app-cdlist">
        	<div class="col">
            <dl>
                <div v-for="item of cdlist">
                    <dt>{{ item.title }}</dt>
                    <dd>{{ item.description }} - {{item.genre}}</dd>
                </div>
            </dl>
        	</div>
        </div> -->

        <div class="table-responsive">
        <table class="table table-sm table-striped" id="app-cdlist">
        	<thead>
        		<tr>
        		<th scope="col">Album</th>
        		<th scope="col">Artist</th>
        		<th scope="col">Genre</th>
        		<th scope="col">Quantity</th>
        	</tr>
        	</thead>
        	<tbody>
        	<tr v-for="cd in cdlist">
        		<td><strong>{{ cd.title }}</strong></td>
        		<td>{{ cd.description }}</td>
        		<td><i>{{ cd.genre }}</i></td>
        		<td><i>{{ cd.number }}</i></td>
        	</tr>
        </tbody>
        </table>
    	</div>

    <hr>
        <div class="row">
            <div class="col">
                <div class="wishlist">
                    <i class="fa fa-spinner fa-spin" style="font-size:24px"></i>
                </div>
            </div>
        </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>


    <script>

        // cdlist key: 1TbS7XG-SYaCJozVz2EtQkWbUHez6IRCJB23ZhLphgBM
        const cdURI = "https://spreadsheets.google.com/feeds/list/1TbS7XG-SYaCJozVz2EtQkWbUHez6IRCJB23ZhLphgBM/1/public/values?alt=json";

        // respose field format
        // ["0"].gsx$artist.$t

        // fetch CD primium data from google spreadsheet

        let cdData = [];

        axios.get(cdURI)
          .then(function (response) {
          	const items = response.data;
            // console.log(response);
            console.log(items.feed.entry);
            for (item of items.feed.entry) {
            	let genre = item.gsx$genre.$t; // todo: make Cap case
            	let artist = item.gsx$artist.$t;
            	let album = item.gsx$title.$t;
            	let number = item.gsx$number.$t
            	let amount = item.gsx$amount.$t

            	thisgift = { title: album, description: artist, genre: genre, number: number, amount: amount};

            	cdData.push(thisgift);
            }
          })
          .catch(function (error) {
            console.log(error);
            cdData.push({ title: "Whoops!", description: "Could not load CD list", genre: ""})
          });


        var appCDlist = new Vue({
          el: '#app-cdlist',
          data: {
            cdlist: cdData
          }
        })
    </script>

</body>
</html>